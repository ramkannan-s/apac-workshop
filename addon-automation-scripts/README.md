# APAC Workshop 2023 - Lab Setup Guide

- [APAC Workshop 2023 - Lab Setup Guide](#apac-workshop-2023---lab-setup-guide)
  - [Prerequisites](#prerequisites)
  - [Scripts to Trigger](#scripts-to-trigger)
      - [Create Users](#create-users)
      - [Create Projects and Map Users](#create-projects-and-map-users)
      - [Create Repositories in Artifactory](#create-repositories-in-artifactory)
      - [Share Repositories with All Projects](#share-repositories-with-all-projects)
      - [Upload Test Data to jf\_lab\_server Artifactory](#upload-test-data-to-jf_lab_server-artifactory)
      - [Script to Trigger during the event](#script-to-trigger-during-the-event)
  - [Lab Updates or Contribution](#lab-updates-or-contribution)
  - [Reference](#reference)
      - [GIT-CRYPT USAGE](#git-crypt-usage)
  - [License](#license)

JFrog SaaS Environments. 

A set of SaaS Environment as per requirement will be created and shared. 


## Prerequisites

- Login to SaaS with default credentials and create a user as `svc_jfrog_user` and with any random password. 
- Install [jq](https://stedolan.github.io/jq/download/) in the VM / Box where the scripts are going to be triggered.
- Install [openssl](https://www.misterpki.com/how-to-install-openssl-on-ubuntu/) in Ubuntu or [openssl](https://www.openssl.org/source/) in Windows or use `brew install openssl` for Mac. 
- Install the [JFrog CLI](https://jfrog.com/getcli/) in the VM / Box where the scripts are going to be triggered. 
- Add the following server :- 
  - Server used by participants - eg: `jf_lab_server`
``` 
jf c add jf_lab_server --url "https://<server_id>.jfrog.io/" --user="svc_jfrog_user" --access-token="****"

jf c use jf_lab_server
```
Access Token to be generated by the JFrog Engineer who is going to setup the Lab. 

**Note**: JF CLI should by default use only the `jf_lab_server`.


## Scripts to Trigger

> **Navigate to `users-groups-projects` folder**. 

> Perform `chmod +x *` inside the folder. 

- - - -

#### Create Users 

* Trigger the script :-
```bash
./createUsers.sh jf_lab_server <usercount>
```

* The above script will first set auto-join for `readers group` to `false` and then reads data from `workshop-users-list.csv` file and create as many users as present in the CSV file. 

* Validate the users are present the JFrog Server.

- - - -

#### Create Projects and Map Users

* Edit the following values in the script (`createProjectsUsers.sh`) with respect to the event to be carried out :
  * `projectCount`
  * `projectnameprefix`
  * `projectidprefix`
  * `userprefix`

* Trigger the script :-
```bash
./createProjectsUsers.sh https://<server_name>.jfrog.io **** <projectCount>
```

* The above script will create projects with respect to the given `projectCount` value in the script and map the respective users of each count to the project created.
eg: `project-1` takes `user-1` as Project Admin

> **Note**: The project count and user count present in CSV should be equal. ie `usercount == projectcount`.

- - - -

> **Navigate to `repository-plus-data` folder.** 

> Perform `chmod +x *` inside the folder.

#### Create Repositories in Artifactory

* Edit the following values in the script (`multi-repo-create.sh`) with respect to the event to be carried out :
  * `repo_name_prefix`
  * `repo_name_suffix`
  * `desc`

* Trigger the script :-
```bash
./multi-repo-create.sh
```

* The above script will create repositories based on the package types given in `repos-to-create.txt` file and the naming convention for the repositories will be `<repo_name_prefix>-<package_type_name>-local-<repo_name_suffix>`.

* Validate the respective repositories are created in the JFrog Artifactory. 

- - - -

#### Share Repositories with All Projects

* Edit the following values in the script (`multi-repo-create.sh`) with respect to the event to be carried out :
  * `repo_name_prefix`
  * `repo_name_suffix`

(**NOTE :** The above values should be the same as values added in #### Create Repositories in Artifactory section.)

* Trigger the script :-
```bash
./share-repo-to-all-projects.sh https://<server_name>.jfrog.io ****
```

* The above script will share the repositories created to all the projects. 

- - - -

#### Upload Test Data to jf_lab_server Artifactory

* Prerequisite :- Add the `proservices` server :- (Source server to download data)
``` 
jf c add proservices --url "https://proservices.jfrog.io/" --user="svc_jfrog_user"
```
The access token will be shared at the time of lab setup


* Edit the following values in the script (`multi-repo-create.sh`) with respect to the event to be carried out :
  * `repo_name_prefix`
  * `repo_name_suffix`

(**NOTE :** The above values should be the same as values added in #### Create Repositories in Artifactory section.)

* Trigger the script :-
```bash
./transfer-data-existing.sh
```

* The above script will download the data from `proservices` artifactory and upload the data to `jf_lab_server` artifactory.

- - - -

#### Script to Trigger during the event

* Participants may require temporary `admin` access to the artifactory for testing some scenarios like Federated Repositories, Access Federation, etc.

* For doing the same during the events and as well to revoke after the section of workshop is completed, trigger the following script :

* Navigate to `users-groups-projects` folder.

* Trigger the script to **Grant admin access** :
```bash
./create-delete-GroupsUsers.sh ramkannan admingroup

./create-delete-GroupsUsers.sh ramkannan addusers 
```

* Trigger the script to **Revoke admin access** :
```bash
./create-delete-GroupsUsers.sh ramkannan deletegroup
```

- - - -

## Lab Updates or Contribution

Pull requests are welcome. For major changes, please open an issue first
to discuss what you would like to change.

Please contact [ramkannans@jfrog.com](ramkannans@jfrog.com) or [shilpak@jfrog.com](shilpak@jfrog.com) for any queries or clarifications

## Reference

#### GIT-CRYPT USAGE
- **git-crypt** enables transparent encryption and decryption of files in a git repository. Files which you choose to protect are encrypted when committed, and decrypted when checked out. git-crypt lets you freely share a repository containing a mix of public and private content. git-crypt gracefully degrades, so developers without the secret key can still clone and commit to a repository with encrypted files. This lets you store your secret material (such as keys or passwords) in the same repository as your code, without requiring you to lock down your entire repository.

- Install [git-crypt](https://github.com/AGWA/git-crypt/blob/master/INSTALL.md).

- Fetch KEY_FILE from the adminstrators of the repository.

- Unlock the file using the following commands :
```bash
git-crypt unlock <path to KEY_FILE>
```

## License

[JFROG](https://jfrog.com/)